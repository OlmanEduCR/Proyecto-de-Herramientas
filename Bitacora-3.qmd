---
title: "BITÁCORA 3 - GRUPO 2"
author: |
  
  **Integrantes:**
  - Cristhian Jimenez Campos — C33973 
  - Olman Camacho Jerez — C31523  
  - Jose Manuel Alfaro Monge — C30244
format:
  pdf:
    toc: false
    number-sections: false
    mainfont: "Times New Roman"
    fontsize: 12pt
    geometry:
      - top=2.5cm
      - bottom=2.5cm
      - left=2.5cm
      - right=2.5cm
    linestretch: 1.5
    latex-engine: xelatex
execute:
  echo: true
  warning: false
  message: false
editor: 
  markdown: 
    wrap: 72
---

## Integrantes

-Cristhian Jimenez Campos C33973

-Olman Camacho Jerez C31523

-Jose Manuel Alfaro Monge C30244

# Bitácora 1

### Pregunta de investigación

¿Cuáles son los factores individuales, sociales y académicos que más
inciden en la predicción de la deserción escolar en estudiantes de nivel
secundario?

### Objeto de estudio

El objeto de estudio es el fenómeno de la deserción escolar, entendido
como el abandono prematuro del sistema educativo formal por parte de los
estudiantes antes de completar el nivel educativo correspondiente.

### Conceptos

#### Deserción escolar:

Según Spady, citado por Floricely Dzay Chulim (2012), se mencionan dos
definiciones operacionales acerca de la deserción universitaria:

a)  Incluye a cualquier persona que abandona la institución de educación
    superior donde se encuentra registrada.\
b)  Se refiere a aquellas personas que no reciben un título o grado de
    ninguna universidad.

Esta segunda definición sostiene que el o la estudiante que haya
iniciado un proceso de aprendizaje superior y, en un determinado periodo
de tiempo, no haya obtenido su respectivo título o grado, puede
considerarse un desertor.

#### Factores personales:

Se entienden como factores personales todas aquellas características
internas del estudiante, como la motivación, las actitudes y las
habilidades cognitivas, que influyen directamente en su aprendizaje.

#### Factores sociales:

Los factores sociales se refieren a todas aquellas influencias externas
relacionadas con el entorno del estudiante, que se presentan en su vida
de manera inesperada o no planificada, y que provienen directamente de
su círculo personal (familiares, amigos cercanos, entre otros). Estas
influencias pueden afectar directamente su rendimiento académico.

### Teorías

#### Teoría de la frustración:

Esta teoría es un aporte del investigador Abram Amsel. Según Alejandro
Baquero (2007), la Teoría de la Frustración de Amsel expone una
hipótesis acerca de la función de la omisión decepcionante de una
recompensa en circunstancias de refuerzo no continuo.

De acuerdo con esta teoría, en la etapa de adquisición, el sujeto
aprende a prever la recompensa obtenida en el contexto experimental
debido a la presencia de claves contextuales que la anuncian. Luego,
cuando la recompensa se omite inesperadamente, el sujeto experimenta una
reacción emocional natural y aversiva denominada **frustración**, la
cual llega a asociarse con las señales que previamente indicaban una
recompensa.

Esto genera un conflicto al inicio del entrenamiento, ya que tanto la
frustración como la recompensa son pronosticadas por condicionamiento
clásico ante los mismos estímulos. A medida que avanza el entrenamiento,
por efecto del contracondicionamiento, el conflicto se resuelve a favor
de la respuesta, ya que el refuerzo no es predecible en una situación de
refuerzo incompleto. De esta forma, la respuesta continúa incluso
durante la extinción, puesto que se ha condicionado la expectativa de
ausencia de recompensa. En cambio, los sujetos que reciben refuerzo
constante no desarrollan este tipo de respuesta al no experimentar la
frustración asociada a la omisión del refuerzo.

## **Teoría de los factores múltiples**

La teoría de los factores múltiples sostiene que la deserción escolar
responde a una combinación de factores individuales, sociales y
académicos.

Basándonos en la base de datos con la que se trabajará, algunos de estos
factores son el desempeño académico, el nivel educativo y los factores
familiares, los cuales pueden aumentar el riesgo de que un alumno
abandone la institución educativa.

La deserción no se ve afectada por un único factor; generalmente se debe
a la interacción de múltiples elementos y, en ocasiones, es difícil
identificar todas las causas. Es fundamental detectar la deserción
académica a tiempo para poder brindar apoyo mediante tutorías,
asistencia económica y programas de acompañamiento psicológico, los
cuales pueden ayudar a prevenir el abandono. Además, es importante
identificar qué factores tienen mayor peso en la decisión de desertar.

## **Teoría de los factores económicos y apoyo familiar en la deserción universitaria**

Esta teoría, sustentada en diversos estudios, señala que las
dificultades económicas, tanto familiares como individuales, tienen un
impacto significativo en los estudiantes, aumentando la probabilidad de
abandono universitario.

Los problemas económicos generan una gran presión sobre los estudiantes,
quienes en muchos casos deben colaborar con el sustento familiar, lo que
puede llevarlos a dejar de lado sus estudios.

Para aliviar esta presión, el acceso a becas y ayudas financieras se
identifica como un factor protector, ya que brinda apoyo económico y
emocional, permitiendo que los estudiantes continúen su formación y
mejoren su rendimiento académico.

#### Bibliografía

Miranda, J., & Vázquez, J. (2023). *Análisis de la deserción estudiantil
universitaria desde una perspectiva analítica*. Revista N° 24, Facultad
de Economía y Negocios. Recuperado de
[https://admisionfen.cl/wp-content/uploads/2024/03/Revista-N%C2%B024_jaime_miranda.pdf](https://admisionfen.cl/wp-content/uploads/2024/03/Revista-N%C2%B024_jaime_miranda.pdf?utm_source=chatgpt.com)

Poveda Velasco, I. M. (2019). *Los factores que influyen sobre la
deserción universitaria: Estudio en la UMRPSFXCh* \[Investigación y
Negocios, 12(20), 63–80\]. Investigación y Negocios.
[https://www.scielo.org.bo/scielo.php?script=sci_arttext&pid=S2521-27372019000200007](https://www.scielo.org.bo/scielo.php?script=sci_arttext&pid=S2521-27372019000200007&utm_source=chatgpt.com)

\[Autor(es)\]. (2021). *Título del artículo*. Revista de Educación (o
nombre completo), volumen (número), páginas. Recuperado de
<https://www.scielo.sa.cr/scielo.php?script=sci_arttext&pid=S2215-34702021000100019>

\[Autor(es)\]. (2023). *Título del artículo*. Revista (o nombre de la
revista), volumen (número), páginas. Recuperado de
<http://www.scielo.edu.uy/scielo.php?script=sci_arttext&pid=S1688-93042023000301206#B56>

\[Autor(es)\]. (2014). *Título del artículo*. Revista (o nombre de la
revista), volumen (número), páginas. Recuperado de
<http://www.scielo.org.co/scielo.php?script=sci_arttext&pid=S2145-94442014000200010>

\[Autor(es)\]. (Año). *Título del artículo*. Revista Revie, volumen
(número), páginas. Recuperado de
<https://revie.gob.do/index.php/revie/article/view/193/365>

\[Autor(es)\]. (Año). *Título del artículo*. Revista RIDE, volumen
(número), páginas. Recuperado de
<https://www.ride.org.mx/index.php/RIDE/article/view/1923/5020>

Dzay Chulim, F., & Narváez Trejo, O. M. (2012). *La deserción escolar
desde la perspectiva estudiantil*. La Editorial Manda.
[https://www.uv.mx/personal/onarvaez/files/2013/02/la-desercion-escolar.pdf](https://www.uv.mx/personal/onarvaez/files/2013/02/la-desercion-escolar.pdf?utm_source=chatgpt.com)

# Bitácora 2

## Datos

#### Características de la tabla:

Esta base de datos contiene registros de 4,424 estudiantes, quienes
serán clasificados de distintas maneras, desde su estado civil hasta los
cursos que están cursando, entre otros. La base de datos fue publicada
en 2021 y presenta diversos factores, incluyendo variables relacionadas
con los padres, para analizar si influyen en la vida académica del
estudiante. Fue creada por Valentim Realinho, Mónica Vieira Martins,
Jorge Machado y Luís Baptista, investigadores del Instituto Politécnico
de Portalegre en Portugal, y puede ser descargada desde el enlace
[link](https://archive.ics.uci.edu/dataset/697/predict+students+dropout+and+academic+success).
Los datos corresponden al segundo semestre, aunque no se especifica el
año.

Las variables están organizadas en distintas categorías: variables
relacionadas con la trayectoria académica, variables demográficas y
variables socioeconómicas. Los tipos de datos incluyen variables
continuas, categóricas y enteras.

#### Población de estudio:

Estudiantes matriculados en diferentes carreras de pregrado de una
institución de educación superior.

#### Muestra observada:

4,424 estudiantes.

#### Unidad estadística o individuos:

Cada uno de los 4,424 estudiantes de educación superior durante
determinados semestres.

#### Identificación de las variables de estudio:

Las variables de estudio incluyen información sobre la trayectoria
académica, datos demográficos y factores socioeconómicos de los
estudiantes, así como su rendimiento académico al final del primer y
segundo semestre. El problema se plantea como una tarea de clasificación
en tres categorías: abandono, matriculado y graduado.

## Primeras 5 filas de la tabla de datos:

```{r}
library(dplyr)
library(ggplot2)
library(tidyr)
datos <- read.csv2("data.csv", sep = ";", header = TRUE, stringsAsFactors = FALSE)
datos <- datos %>%
  select(-GDP) ### El uso de esta variable es irrelevante
head(datos, 5)
```

La tabla se encuentra en formato tabular, esto se puede ver y también se
comenta en la página de descarga

## Resumen de 5 números de las variables cuantitativas y analizar el mismo:

```{r}
library(dplyr)
# Se seleciona las variables cuantitaticas
variables_cuantitativas <- select_if(datos, is.numeric)
# Calcular resumen de 5 números para cada variable
#'Vamos a usar sapply para aplicar la funcion fivenum a la base
#'el firenum es una funcion que nos ayuda a calcular el minimo y maximo, los Q1 y Q3, ademas de eso la mediana 
resumen_5_numeros <- sapply(variables_cuantitativas, fivenum)
#para no tener problema trasponemos a resumen_5_numeros
resumen_5_numeros <- t(resumen_5_numeros)
#'Para facilitar la lectura vamos a ponerle nosmbres claros a las columnas
colnames(resumen_5_numeros) <- c("Minimo","Q1","Mediana","Q3","Máximo")
print(resumen_5_numeros)

```

La tabla muestra el resumen de cinco números de las variables
cuantitativas de nuestra base de datos. En ella se puede observar que la
mayoría de las variables tienen un valor mínimo de 0. La forma en que se
evalúan nuestras variables es diferente, ya que cada una tiene rangos
distintos para su asignación; por lo tanto, pueden ser continuas o
presentar saltos en los valores, como pasar de 33 a 53, entre otros.

## Hacer al menos un gráfico que describa la distribución para cada una de las variables cuantitativas:

```{r}
ggplot(datos, aes(x = factor(Curricular.units.2nd.sem..evaluations.))) +
  geom_bar(fill = "#C26827", color = "#000000") +
  labs(
    title = "Distribución de Evaluaciones - 2do Semestre",
    x = "Cantidad de Evaluaciones",
    y = "Frecuencia"
  ) +
  theme_minimal()
  

```

## Hacer al menos dos gráficos que describan la relación entre las variables:

```{r}
grafico_internacional_genero <- function(datos, genero, internacional, pais) {
  df_plot <- datos %>%
    mutate(
      genero = factor({{genero}}, levels = c(1, 0), labels = c("Hombres", "Mujeres")),
      tipo = factor({{internacional}}, levels = c(0, 1), labels = c("Nacional", "Internacional"))
    ) %>%
    group_by(genero, tipo) %>%
    summarise(Frecuencia = n(), .groups = "drop")
  
  ggplot(df_plot, aes(x = tipo, y = Frecuencia, fill = genero)) +
    geom_col(position = "dodge", width = 0.7) +
    geom_text(aes(label = Frecuencia),
              position = position_dodge(width = 0.7),
              vjust = -0.3, size = 3.5) +
    scale_fill_manual(values = c("#BA6F14", "#FF0000")) +
    labs(
      title = "Distribución de Internacionales y Nacionales por Género",
      x = "Lugar de Procedencia",
      y = "Frecuencia",
      fill = "Género"
    ) +
    theme_minimal(base_size = 12) +
    theme(
      legend.position = "bottom",
      plot.title = element_text(face = "bold"),
      axis.text.x = element_text(angle = 0, hjust = 0.5)
    )
}
grafico_internacional_genero(datos, datos$Gender, datos$International, datos$Nacionality)

gráfico_necesidad_genero <- function(df, genero, needs){
  df_plot <- datos %>%
    mutate(
      genero = factor({{genero}}, levels = c(1, 0), labels = c("Hombres", "Mujeres")),
      necesidades = factor({{needs}}, levels = c(0, 1),
      labels = c("Sin necesidades especiales", "Con necesidades especiales"))
    ) %>%
    group_by(genero, necesidades) %>%
    summarise(Frecuencia = n(), .groups = "drop")
  
  ggplot(df_plot, aes(x = necesidades, y = Frecuencia, fill = genero)) +
    geom_col(position = "dodge", width = 0.7) +
    geom_text(aes(label = Frecuencia),
    position = position_dodge(width = 0.7),
    vjust = -0.3, size = 3.5) +
    scale_fill_manual(values = c("#1250C4", "#8F0FD6")) +
    labs(
      title = "Distribución de Necesidades Educativas Especiales por Género",
      x = "Condición",
      y = "Frecuencia",
      fill = "Género"
    ) +
    theme_minimal(base_size = 12) +
    theme(
      legend.position = "bottom",
      plot.title = element_text(face = "bold"),
      axis.text.x = element_text(angle = 0, hjust = 0.5)
    )
}
gráfico_necesidad_genero(datos, datos$Gender, datos$Educational.special.needs)
```

## Hacer al menos un gráfico que muestre la distribución de las variables categóricas:

```{r}
ggplot(datos, aes(x = factor(Gender, 
                             levels = c(0, 1), 
                             labels = c("Mujer", "Hombre")))) +
  geom_bar(fill = "#6049A6", color = "#42298A") +
  labs(
    title = "Distribución por Género",
    x = "Género",
    y = "Frecuencia"
  ) +
  theme_minimal()
```

## Identificar valores faltantes y posibles outliers:

```{r}
datos_faltantes <- datos %>% 
  filter(if_any(everything(),is.na))
head(datos_faltantes)

datos %>% 
  summarise(
    across(
      where(is.numeric),
      ~sum(
        .<quantile(.,0.25,na.rm=TRUE)-1.5*IQR(.)|
        .>quantile(.,0.75,na.rm=TRUE)+1.5*IQR(.),na.rm = TRUE
        
      )
    )
  )#cantidad de outliners por variable

es_outlier <- function(x) {
  
  if(!is.numeric(x)) return(rep(FALSE,length(x)))
  q1 <- quantile(x,0.25,na.rm = TRUE)
  q3 <- quantile(x,0.75,na.rm = TRUE)
  
  resultado <- x<(q1-1.5*IQR(x,na.rm = TRUE))|
                x>(q3+1.5*IQR(x,na.rm = TRUE))
  return(resultado)
}

outliers <- as.data.frame(sapply(datos,es_outlier))
head(outliers)

```

## Investigar técnicas que permitan subsanar los valores perdidos y outliers

Manejo de valores faltantes y outliers

Valores faltantes:

Los valores faltantes pueden ser tratados mediante diferentes métodos que modifican los datos de distinta manera. Por eso, a la hora de utilizarlos, sus resultados se verán afectados de mayor o menor forma dependiendo de la técnica utilizada. Existen técnicas como la eliminación de los datos faltantes, sin embargo, esta práctica puede perjudicar el análisis de los datos, por lo que nos centraremos en los métodos que buscan modificarlos de manera que aporten información.

Se pueden utilizar métodos simples como la imputación por la media, mediana o moda, que son fáciles de implementar; sin embargo, estos datos pueden verse distorsionados por la presencia de valores atípicos. Por eso existen métodos más robustos como la imputación por vecinos más cercanos, imputación por regresión, imputación múltiple o imputación por series de tiempo. Estas técnicas conservan de mejor manera la estructura de los datos.

Outliers:

Hay tres opciones posibles a la hora de enfrentar un outlier, tanto univariable como multivariable. Estas opciones son eliminarlo, mantenerlo o reemplazarlo. Al igual que con los valores faltantes, se pueden eliminar todos los outliers, pero este método provoca pérdida de información que normalmente es valiosa y aporta a la investigación.

También se tiene la opción de utilizar métodos simples como reemplazarlos por la media o la moda, aunque el uso de estas técnicas no es recomendado porque puede generar resultados artificiales y sesgados. Por lo tanto, se recomienda utilizar técnicas más robustas que reduzcan su influencia sin eliminarlos por completo.

Ahora veremos algunas formas de enfrentar los outliers dependiendo de si son univariables o multivariables.

Outliers univariable

Detectar y clasificar:
Se realiza una revisión manual para determinar si son errores, casos aleatorios o datos de interés que deberían analizarse por separado. Luego se decide individualmente qué hacer con cada uno.

Winsorización:
Se sustituye el dato por el valor del percentil más cercano. Esto conserva la estructura de los datos y limita los efectos sobre las estadísticas principales.

Outliers multivariable

Revisión contextual:
Se verifica que las variables que se estén comparando no tengan una relación incoherente o anómala que genere valores extraños o fuera de contexto.

Análisis por separado:
Se analizan los casos atípicos como un conjunto separado de los datos comunes para identificar patrones sin alterar los datos principales.

Regresión:
Son métodos que consisten en modelar la relación de una variable dependiente con otras independientes, para evaluar la influencia de los outliers sobre las relaciones entre variables.

#### Bibliografía:

Rosas, J. F. M. (2009). *Métodos de imputación para el tratamiento de
datos faltantes*. Revista de Métodos Cuantitativos para la Economía y la
Empresa. Recuperado de
[https://www.redalyc.org/pdf/2331/233117228001.pdf](https://www.redalyc.org/pdf/2331/233117228001.pdf?utm_source=chatgpt.com)

Medina, F., & Galván, M. (2007). *Imputación de datos: Teoría y
práctica*. Serie Estudios Estadísticos y Prospectivos, N.º 54. Santiago
de Chile: ONU-CEPAL.
<https://repositorio.cepal.org/server/api/core/bitstreams/02dd479f-fae2-43c4-b5ec-5419fa7f6190/content>

Rosas, J. F. M., & Álvarez Verdejo, E. (2009). *Métodos de imputación
para el tratamiento de datos faltantes: Aplicación mediante R/S-PLUS*.
Revista de Métodos Cuantitativos para la Economía y la Empresa, (07),
03-30.
[https://www.redalyc.org/pdf/2331/233117228001.pdf](https://www.redalyc.org/pdf/2331/233117228001.pdf?utm_source=chatgpt.com)

Cousineau, D. (2010). *Outliers detection and treatment: A review*.
International Journal of Psychological Research, 3(1), 58-67.
[https://www.redalyc.org/pdf/2990/299023509004.pdf](https://www.redalyc.org/pdf/2990/299023509004.pdf?utm_source=chatgpt.com)

Leys, C., Delacre, M., Mora, Y. L., Lakens, D., & Ley, C. (2019). How to
classify, detect, and manage univariate and multivariate outliers, with
emphasis on pre-registration. *International Review of Social
Psychology, 32*(1). <https://doi.org/10.5334/irsp.289>

===============================================================================================================
\# Bitácora 3
=============================================================================================================== 
1. Técnicas o Métodos Estadísticos Seleccionados

Regresión Logística Binaria: para modelar la probabilidad de deserciónen función de factores individuales, sociales y académicos.

2.Marco Metodológico 

Etapas preliminares del analisis

Estadística descriptiva: Nos ayuda a recolectar, organizar, analizar y presentar un conjunto de datos que nos ayuda a conocer sus principales características.

Análisis Exploratorio de Datos (EDA): Para comprender la distribución y relaciones básicas entre variables.

Método estadístico principal: Regresión Logística Binaria
La regresión logística modela la probabilidad de que un evento ocurra (en este caso, deserción) mediante la función logística:

P(Y=1/X)=1/(1+e\^−(β_0+β_1*X_1+⋯+β_p*X_p)) Donde:

Y es la variable dependiente binaria (Dropout vs Graduate/Enrolled)
X_1,…,X_p son las variables predictoras
β_0,…,β_p son los coeficientes a estimar
La estimación se realiza mediante máxima verosimilitud, maximizando la función:

ℓ(β)=∑(i=1 hasta n)\[y_i*log(p_i)+(1−y_i)*log(1−p_i)\]

Fundamento estadístico:
  La regresión logística modela la relación entre un conjunto de variables predictoras y la probabilidad de ocurrencia del evento.

Justificación:
  En nuestro caso, la regresión logística binaria es apropiada ya que nuestro análisis está centrado en una variable binaria, que toma el valor 1 en caso de "Dropout" y 0 en caso contrario. El uso de esta técnica permite evaluar cómo se relacionan múltiples factores, que en nuestro caso pueden ser académicos y socioeconómicos. Nos facilita la interpretación mediante odds ratios, además de ser un método confiable y simple, ampliamente utilizado en investigación.

3- Aplique dichas técnicas o métodos. Presente los resultados,
analícelos y responda su pregunta de investigación.

**Estadística descriptiva**

```{r}
columnas_seleccionadas <- datos[, c(
                                  "Admission.grade", 
                                  "Age.at.enrollment",
                                  "Previous.qualification..grade.",
                                  "Curricular.units.1st.sem..grade.", 
                                  "Curricular.units.2nd.sem..grade." 
                                   )]
#pasa r chr a num y pasar int a num
columnas_seleccionadas <- as.data.frame(lapply(columnas_seleccionadas, function(x) {
  if(is.character(x)) {
    # Convertir a numérico (maneja decimales)
    return(as.numeric(as.character(x)))
  } else {
    return(x)
  }
}))
str(columnas_seleccionadas)
```

```{r}
calcular_moda <- function(x){
  x <- x[!is.na(x)]
  if(length(x) == 0) return(NA)
  
  tabla <- table(x)
  moda <- as.numeric((names(tabla)[tabla == max(tabla)]))
  return(moda[1])
}
```

```{r}
estadisticas_descrip <- data.frame(
  Media = sapply(columnas_seleccionadas, mean, na.rm = TRUE),
  Mediana = sapply(columnas_seleccionadas, median, na.rm = TRUE),
  Moda = sapply(columnas_seleccionadas, calcular_moda),
  Desviacion_Estandar = sapply(columnas_seleccionadas, sd, na.rm = TRUE),
  Minimo = sapply(columnas_seleccionadas, min, na.rm = TRUE),
  Maximo = sapply(columnas_seleccionadas, max, na.rm = TRUE),
  Rango = sapply(columnas_seleccionadas, function(x) diff(range(x, na.rm = TRUE)))
)
print(estadisticas_descrip)
```

```{r}
par(mfrow = c(2, 4))  # Parámetros gráficos 

nombres_var <- names(columnas_seleccionadas) # Extrae los nombres y los asigna al vector nombre_var

for(i in 1:ncol(columnas_seleccionadas)) { # Bucle para generar los histogramas, iterando sobre las variables del data frame
  hist(columnas_seleccionadas[[i]], #Estructura que va a tener el histograma 
       main = nombres_var[i],
       cex.main = 0.9, 
       xlab = "Valor",
       ylab = "Frecuencia",
       col = "lightblue",
       border = "black")
}
```

**analisis** En el análisis estadístico nos ayuda a poder ver las
variables, pudiendo analizar y comprar, tipo se puede ver uno como la
moda, lo cual sería los valores más frecuentes, el rango difiere entre
valores máximos y mínimos. En las gráficas se puede ver los histogramas,
en el cual se puede ver las variables que se seleccionaron y se le
signaron en columnas_seleccionadas, se grafica esto, para tener una idea
del comportamiento de estas variables.

*Este apartado es para los tipos de variables*

```{r}
datos_num <- datos %>%
  select(
    Previous.qualification..grade.,
    Application.order,
    Admission.grade,
    Age.at.enrollment,
    Curricular.units.1st.sem..credited.,
    Curricular.units.1st.sem..enrolled.,
    Curricular.units.1st.sem..approved.,
    Curricular.units.1st.sem..evaluations.,
    Curricular.units.1st.sem..grade.,
    Curricular.units.1st.sem..without.evaluations.,
    Curricular.units.2nd.sem..credited.,
    Curricular.units.2nd.sem..enrolled.,
    Curricular.units.2nd.sem..evaluations.,
    Curricular.units.2nd.sem..approved.,
    Curricular.units.2nd.sem..grade.,
    Curricular.units.2nd.sem..without.evaluations.,
  )

tabla_num <- data.frame(
  Variables_Numericas = names(datos_num)
)

tabla_num

datos_cat <- datos %>%
  select(
    Marital.status,
    Application.mode,
    Course,
    Daytime.evening.attendance.,
    Previous.qualification,
    Nacionality,
    Mother.s.qualification,
    Father.s.qualification,
    Mother.s.occupation,
    Father.s.occupation,
    Displaced,
    Educational.special.needs,
    Debtor,
    Tuition.fees.up.to.date,
    Gender,
    Scholarship.holder,
    International,
    Target
  )

tabla_cat <- data.frame(
  Variables_Categoricas = names(datos_cat)
)

tabla_cat
```

# **Aplicando Regresión Logística**

Nota: Se utilizaron más técnicas para verificar la veracidad de la
información obtenida, de esta manera, se presentan los resultados

```{r}
#install.packages("rcompanion")
#install.packages("ResourceSelection")
#install.packages("pROC")
#install.packages("car")

library(rcompanion)
library(ResourceSelection)
library(pROC)
library(car)
### Pasamos los casos de Desertor y Matriculado/Graduado a 1,0 respectivamente
datos$Target_bin <- ifelse(datos$Target == "Dropout", 1, 0)
datos$Target_bin <- factor(datos$Target_bin, levels = c(0, 1))

modelo <- glm(Target_bin ~ Age.at.enrollment + 
                Curricular.units.1st.sem..enrolled. + 
                Curricular.units.1st.sem..approved. + 
                Curricular.units.2nd.sem..enrolled. + 
                Curricular.units.2nd.sem..approved. + 
                Marital.status + 
                Course + 
                Displaced + 
                Educational.special.needs + 
                Debtor + 
                Tuition.fees.up.to.date + 
                Gender + 
                Scholarship.holder +
                International +
                Mother.s.qualification +
                Father.s.qualification +
                Mother.s.occupation +
                Father.s.occupation, 
              data = datos, 
              family = binomial)

summary(modelo)

### Convertir coeficientes a Odds Ratios

exp(coef(modelo))
## intervalos de confianza
exp(confint(modelo))

### Evaluación del modelo

# Nagelkerke
nagelkerke(modelo)

# Matriz de confusión
prob <- predict(modelo, type = "response")
pred <- ifelse(prob > 0.5, 1, 0)
pred <- factor(pred, levels = c(0, 1))

table(Predicción = pred, Real = datos$Target_bin)

# Curva ROC y AUC

roc_curve <- roc(datos$Target_bin, prob)
auc(roc_curve)

### Revisar multicolinealidad (VIF)
vif(modelo)
```

**Calidad global del modelo**

***Nagelkerke= 0.638***

Un pseudo-R² de 0.63 es excelente para un modelo de regresión logística,
ya que logra explicar un 63% de la probabilidad de deserción.

***AUC*** **= 0.915**

Esto quiere decir que es un modelo altamente predictivo, ya que según su
escala, por encima del 0.90 es un modelo sobresaliente

## **Interpretación de coeficientes importantes (Odds Ratios)**

### Variables académicas

Son las más relevantes. Dominan completamente el modelo.

| Variable | OR | Interpretación |
|------------------------|------------------------|------------------------|
| 1st.sem.enrolled | **1.21** | Cada curso *inscrito* extra implica que aumente la probabilidad de deserción 21% |
| 1st.sem.approved | **0.80** | Cada curso aprobado extra implica que reduce un 20% la probabilidad |
| 2nd.sem.enrolled | **1.57** | Los estudiantes “sobrecargados” tienden a salirse |
| 2nd.sem.approved | **0.52** | Cada aprobación implica que reduzca la probabilidad en casi 50% |

**Conclusión:** La carga académica y el rendimiento explican casi toda
la deserción.

------------------------------------------------------------------------

### **Variables financieras**

| Variable | OR | Interpretación |
|------------------------|------------------------|------------------------|
| Tuition.fees.up.to.date | **0.10** | Estar al día reduce la deserción un 90% |
| Debtor | **1.61** | Los deudores hacen que aumente un 61% la probabilidad |

**Conclusión:** Las finanzas son otro bloque crítico.

------------------------------------------------------------------------

### **Variables personales**

| Variable           | OR       | Interpretación                                 |
|-----------------|-----------------|--------------------------------------|
| Age.at.enrollment  | **1.05** | Más edad → ↑ riesgo pequeño pero significativo |
| Gender (Hombres)   | **1.37** | Mayor riesgo que las mujeres                   |
| Scholarship.holder | **0.56** | Becarios desertan menos                        |

------------------------------------------------------------------------

### **Variables familiares**

Estás variables aportan, pero marginalmente.

| Variable               | p-valor | OR    | Conclusión                         |
|----------------|----------------|----------------|-------------------------|
| Mother.s.qualification | 0.027   | 1.008 | Efecto pequeño, pero significativo |
| Mother.s.occupation    | 0.009   | 0.988 | Ligera reducción del riesgo        |

### Variables que no aportan

-   Toda variable relacionada con el padre
-   La nacionalidad

------------------------------------------------------------------------

# **Matriz de confusión**

El código presenta lo siguiente:

-   Verdaderos negativos: 2836
-   Falsos negativos: 379
-   Verdaderos positivos: 1042
-   Falsos positivos: 167

### Métricas aproximadas:

-   Efectividad ≈ 88.0%
-   Sensibilidad ≈ 73%
-   Especificidad ≈ 94%

Así, el modelo detecta muy bien a los que NO desertan; sin embargo, se
pierde un porcentaje considerable de desertores (379 casos).

------------------------------------------------------------------------

# **Conclusiones claras**

Así entonces, podemos concluir, gracias a la técnica de Regresión
Logística, que los factores que afectan más a las deserciones en
educación superior son los factores financieros y académicos. Además, se
presentan los factores personales y familiares, los cuales generan un
aporte en la deserción, pero no de manera tan significativa. De igual
manera, existen factores geográficos y personales que no afectan en lo
absoluto en la deserción.

------------------------------------------------------------------------

Gráficos relacionados:

```{r}
datos %>%
  mutate(
    Target = factor(
      Target,
      levels = c("Graduate", "Enrolled", "Dropout"),
      labels = c("No Desertor", "No Desertor", "Desertor")
    )
  ) %>%
  ggplot(aes(x = Target, fill = Target)) +
  geom_bar(aes(y = after_stat(count / sum(count)))) +
  geom_text(
    aes(
      y = after_stat(count / sum(count)),
      label = paste0(round(after_stat(count / sum(count)) * 100, 1), "%")
    ),
    stat = "count",
    vjust = -0.5,
    size = 4
  ) +
  scale_fill_manual(
    values = c("No Desertor" = "steelblue",
               "Desertor"    = "firebrick")
  ) +
  labs(
    title = "Distribución de Deserción Escolar",
    x = "Estado del Estudiante",
    y = "Proporción"
  ) 
```

```{r}
datos %>%
  mutate(
    Target = factor(Target,
                    levels = c("Graduate", "Enrolled", "Dropout"),
                    labels = c("No Desertor", "No Desertor", "Desertor"))
  ) %>%
  # Agrupar para proporciones
  group_by(Gender, Target) %>%
  summarise(n = n(), .groups = "drop") %>%
  group_by(Gender) %>%
  mutate(prop = n / sum(n)) %>%
  
  ggplot(aes(x = factor(Gender), y = prop, fill = Target)) +
  geom_bar(stat = "identity", position = "stack", alpha = 0.9) +
  geom_text(
    aes(label = paste0(round(prop * 100, 1), "%")),
    position = position_stack(vjust = 0.5),
    color = "white",
    fontface = "bold",
    size = 4
  ) +
  
  scale_fill_manual(values = c("steelblue", "firebrick")) +
  
  scale_y_continuous(labels = scales::percent) +
  
  labs(
    title = "Distribución de Deserción por Género",
    x = "Género (0 = Mujer, 1 = Hombre)",
    y = "Proporción",
    fill = "Estado"
  )
```

```{r}
datos %>%
  mutate(
    Target = factor(
      Target,
      levels = c("Graduate", "Enrolled", "Dropout"),
      labels = c("No Desertor", "No Desertor", "Desertor")
    )
  ) %>%
  count(Age.at.enrollment, Target) %>%
  group_by(Age.at.enrollment) %>%
  mutate(prop = n / sum(n)) %>%
  
  ggplot(aes(x = Age.at.enrollment, y = prop, color = Target)) +
  geom_line(size = 1.3, alpha = 0.9) +
  geom_point(size = 3) +
  scale_color_manual(
    values = c("No Desertor" = "steelblue",
               "Desertor"    = "firebrick")
  ) +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(
    title = "Proporción de Deserción según la Edad de Ingreso",
    x = "Edad al momento de ingreso",
    y = "Proporción",
    color = "Estado"
  )
```

```{r}
datos %>%
  mutate(
    Target = factor(
      Target,
      levels = c("Graduate", "Enrolled", "Dropout"),
      labels = c("No desertor", "No desertor", "Desertor")
    )
  ) %>%
  select(
    Target,
    Matriculados = Curricular.units.1st.sem..enrolled.,
    Aprobados = Curricular.units.1st.sem..approved.
  ) %>%
  pivot_longer(
    cols = c(Matriculados, Aprobados),
    names_to = "Variable",
    values_to = "Valor"
  ) %>%
  
  ggplot(aes(x = Target, y = Valor, fill = Variable)) +
  geom_boxplot(alpha = 0.75, width = 0.7, outlier.size = 1.5) +
  
  scale_fill_manual(
    values = c("Matriculados" = "steelblue",
               "Aprobados" = "firebrick")
  ) +
  
  labs(
    title = "Distribución de Créditos Matriculados y Aprobados en el 1er Semestre según Estado Académico",
    x = "Estado académico",
    y = "Número de créditos",
    fill = ""
  )
```

```{r}
datos %>%
  mutate(
    Target = factor(
      Target,
      levels = c("Graduate", "Enrolled", "Dropout"),
      labels = c("No desertor", "No desertor", "Desertor")
    )
  ) %>%
  select(
    Target,
    Matriculados = Curricular.units.2nd.sem..enrolled.,
    Aprobados = Curricular.units.2nd.sem..approved.
  ) %>%
  pivot_longer(
    cols = c(Matriculados, Aprobados),
    names_to = "Variable",
    values_to = "Valor"
  ) %>%
  
  ggplot(aes(x = Target, y = Valor, fill = Variable)) +
  geom_boxplot(alpha = 0.75, width = 0.7, outlier.size = 1.5) +
  
  scale_fill_manual(
    values = c("Matriculados" = "steelblue",
               "Aprobados" = "firebrick")
  ) +
  
  labs(
    title = "Distribución de Créditos Matriculados y Aprobados en el 2do Semestre según Estado Académico",
    x = "Estado académico",
    y = "Número de créditos",
    fill = ""
  )
```
